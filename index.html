<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineTray - Your Movie Watchlist</title>
    <meta name="description" content="Track your favorite movies and TV shows with CineTray">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="CineTray">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="CineTray">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon and App Icons -->
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- PWA Splash Screens -->
    <meta name="apple-mobile-web-app-status-bar" content="#6366f1">
    <link rel="apple-touch-startup-image" href="splash.png">
    <link rel="manifest" href="manifest.json" crossorigin="use-credentials">
    
    <!-- Theme Color for Different Browsers -->
    
    <!-- Theme Color for Different Browsers -->
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#6366f1">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#4f46e5">
    
    <!-- Preconnect to External Domains -->
    <link rel="preconnect" href="https://www.google.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --background: #ffffff;
            --text: #1f2937;
            --text-secondary: #6b7280;
            --border: #e5e7eb;
            --error: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        [data-theme="dark"] {
            --background: #111827;
            --text: #f9fafb;
            --text-secondary: #9ca3af;
            --border: #374151;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
            box-sizing: border-box;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 1rem 1rem;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }
        
        /* Header Actions */
        .header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        /* Install Button */
        .install-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .install-button:hover {
            background: var(--primary-dark);
        }
        
        .dark-mode .install-button {
            background: var(--primary-dark);
        }
        
        .dark-mode .install-button:hover {
            background: var(--primary);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: linear-gradient(45deg, #ffffff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
        }

        .logo i {
            font-size: 2.2rem;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.6rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .search-container {
            background: var(--bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin: 0 -1.5rem 2rem -1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            width: calc(100% + 3rem);
            box-sizing: border-box;
        }

        .input-group {
            display: flex;
            gap: 0.75rem;
            margin: 0 0 1rem 0;
            width: 100%;
            padding: 0;
            box-sizing: border-box;
        }

        .input-field {
            flex: 1 1 0%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            min-width: 0;
            width: 100%;
            box-sizing: border-box;
        }

        .btn-add {
            padding: 0 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            background: var(--primary);
            color: white;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .btn-add:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .filters-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 0.5rem;
            padding: 0.25rem 1rem;
            display: flex;
            justify-content: center;
        }

        .filters {
            display: inline-flex;
            gap: 0.75rem;
            background: var(--bg-secondary);
            padding: 0.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            width: auto;
        }

        .filter-btn {
            padding: 0.4rem 1.2rem;
            border: none;
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 2px;
            min-width: 70px;
            text-align: center;
            height: 32px;
            line-height: 1.2;
            white-space: nowrap;
        }
        
        /* Make the middle button wider */
        .filter-btn[data-filter="to-watch"] {
            min-width: 90px;
            padding: 0.4rem 1.5rem;
        }

        .filter-btn:hover {
            background: var(--border);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
        }

        .watchlist-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg);
            border: 2px solid var(--border);
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border);
        }

        .suggestion-item:hover {
            background: var(--secondary);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .watchlist {
            display: grid;
            gap: 1rem;
        }

        .watchlist-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.5rem 1rem;
        }

        .item-title {
            grid-column: 1;
            grid-row: 1;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-badge {
            grid-column: 2;
            grid-row: 1;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            text-align: right;
        }

        .status-watched {
            background: var(--success);
            color: white;
        }

        .status-to-watch {
            background: var(--warning);
            color: white;
        }

        .item-dates {
            grid-column: 1;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .item-actions {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            align-items: flex-start;
        }

        .action-btn {
            padding: 0.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.9;
        }

        .action-btn:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .action-btn i {
            font-size: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .bulk-actions {
            display: none;
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateX(100%);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--danger);
        }

        .checkbox {
            width: 1.2rem;
            height: 1.2rem;
            margin-right: 0.5rem;
        }

        .position-relative {
            position: relative;
        }

        /* Button Styles */
        .btn-watch {
            background: var(--success);
            color: white;
        }

        .btn-unwatch {
            background: var(--warning);
            color: white;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        .action-btn {
            padding: 0.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.9;
        }

        .action-btn:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .header {
                margin-bottom: 1rem;
                padding: 1.5rem 0;
            }

            .logo {
                font-size: 2rem;
            }

            .stats {
                gap: 0.5rem;
            }

            .stat-card {
                padding: 0.75rem;
            }

            .stat-number {
                font-size: 1.25rem;
            }

            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .item-title {
                font-size: 1.1rem;
            }

            .item-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .notification {
                top: 1rem;
                right: 1rem;
                left: 1rem;
                right: 1rem;
            }
        }

        @media (max-width: 480px) {
            .stats {
                gap: 0.4rem;
            }

            .controls {
                padding: 1rem;
            }

            .watchlist-item {
                padding: 1rem;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* PWA specific styles */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            .header {
                padding-top: calc(env(safe-area-inset-top) + 1rem);
            }
        }

        /* Prevent text selection on buttons for better mobile feel */
        .btn, .filter-btn, .action-btn, .theme-toggle {
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Smooth transitions for theme switching */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-film"></i>
                    CineTray
                </div>
                <div class="header-actions">
                    <button id="install-button" class="install-button" style="display: none;">
                        <i class="fas fa-download"></i> Install
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="stats">
            <div class="stat-card">
                <span class="stat-number" id="totalCount">0</span>
                <span class="stat-label">Total Items</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="watchedCount">0</span>
                <span class="stat-label">Watched</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="toWatchCount">0</span>
                <span class="stat-label">To Watch</span>
            </div>
        </div>

        <div class="controls">
            <div class="input-group">
                <div class="position-relative" style="flex: 1;">
                    <input type="text" id="titleInput" class="input-field" placeholder="Enter movie or series title..." autocomplete="off">
                    <div class="search-suggestions" id="suggestions"></div>
                </div>
                <button class="btn-add" onclick="addItem()">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div class="filters-container">
                <div class="filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="to-watch">To Watch</button>
                    <button class="filter-btn" data-filter="watched">Watched</button>
                </div>
            </div>
        </div>

        <div class="bulk-actions" id="bulkActions">
            <!-- Bulk actions removed as requested -->
        </div>

        <div class="watchlist-container">
            <div class="watchlist" id="watchlist">
                <div class="empty-state">
                    <i class="fas fa-film"></i>
                    <h3>Your watchlist is empty</h3>
                    <p>Start adding movies and series to keep track of what you want to watch!</p>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Remove all bulk-related functions and variables
        let watchlist = JSON.parse(localStorage.getItem('cinetray-watchlist') || '[]');
        let currentFilter = 'all';

        // Sample movie titles for suggestions
        const sampleMovies = [
            "The Shawshank Redemption", "The Godfather", "The Dark Knight", "Pulp Fiction",
            "The Lord of the Rings", "Forrest Gump", "Inception", "Fight Club",
            "The Matrix", "Goodfellas", "The Empire Strikes Back", "One Flew Over the Cuckoo's Nest",
            "Se7en", "The Silence of the Lambs", "It's a Wonderful Life", "Schindler's List",
            "Saving Private Ryan", "The Green Mile", "Interstellar", "Parasite",
            "Avengers: Endgame", "Titanic", "Avatar", "Black Panther", "Spider-Man: Into the Spider-Verse"
        ];

        function saveData() {
            localStorage.setItem('cinetray-watchlist', JSON.stringify(watchlist));
            updateStats();
            renderWatchlist();
        }

        function updateStats() {
            const total = watchlist.length;
            const watched = watchlist.filter(item => item.status === 'watched').length;
            const toWatch = total - watched;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('watchedCount').textContent = watched;
            document.getElementById('toWatchCount').textContent = toWatch;
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function addItem() {
            const titleInput = document.getElementById('titleInput');
            const title = titleInput.value.trim();

            if (!title) {
                showNotification('Please enter a title');
                return;
            }

            // Check for duplicates
            const exists = watchlist.find(item => 
                item.title.toLowerCase() === title.toLowerCase()
            );

            if (exists) {
                showNotification('This title already exists in your watchlist');
                return;
            }

            const newItem = {
                id: generateId(),
                title: title,
                status: 'to-watch',
                dateAdded: new Date().toLocaleDateString(),
                dateWatched: null
            };

            watchlist.unshift(newItem);
            titleInput.value = '';
            hidesuggestions();
            saveData();
            showNotification(`"${title}" added to your watchlist!`);
        }

        function deleteItem(id) {
            if (confirm('Are you sure you want to remove this item?')) {
                const item = watchlist.find(item => item.id === id);
                watchlist = watchlist.filter(item => item.id !== id);
                saveData();
                showNotification(`"${item.title}" removed from watchlist`);
            }
        }

        function toggleStatus(id) {
            const item = watchlist.find(item => item.id === id);
            if (item) {
                if (item.status === 'watched') {
                    item.status = 'to-watch';
                    item.dateWatched = null;
                    showNotification(`"${item.title}" marked as to watch`);
                } else {
                    item.status = 'watched';
                    item.dateWatched = new Date().toLocaleDateString();
                    showNotification(`"${item.title}" marked as watched!`);
                }
                saveData();
            }
        }

        function openGoogleSearch(title) {
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(title + ' movie')}`;
            window.open(searchUrl, '_blank');
        }

        function renderWatchlist() {
            const watchlistEl = document.getElementById('watchlist');
            let filteredItems = watchlist;

            if (currentFilter === 'watched') {
                filteredItems = watchlist.filter(item => item.status === 'watched');
            } else if (currentFilter === 'to-watch') {
                filteredItems = watchlist.filter(item => item.status === 'to-watch');
            }

            // Sort: to-watch items first, then by date added (newest first)
            filteredItems.sort((a, b) => {
                if (a.status === 'to-watch' && b.status === 'watched') return -1;
                if (a.status === 'watched' && b.status === 'to-watch') return 1;
                return new Date(b.dateAdded) - new Date(a.dateAdded);
            });

            if (filteredItems.length === 0) {
                watchlistEl.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-film"></i>
                        <h3>No items found</h3>
                        <p>${currentFilter === 'all' ? 'Your watchlist is empty' : `No ${currentFilter.replace('-', ' ')} items`}</p>
                    </div>
                `;
                return;
            }

            watchlistEl.innerHTML = filteredItems.map(item => `
                <div class="watchlist-item">
                    <div class="item-title" onclick="openGoogleSearch('${item.title.replace(/'/g, "\\'")}')">
                        ${item.title}
                    </div>
                    <div class="status-badge ${item.status === 'watched' ? 'status-watched' : 'status-to-watch'}">
                        ${item.status === 'watched' ? 'Watched' : 'To Watch'}
                    </div>
                    <div class="item-dates">
                        <span class="date-added">
                            Added: ${item.dateAdded}
                        </span>
                        ${item.dateWatched ? `<span class="date-added">Watched: ${item.dateWatched}</span>` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="action-btn ${item.status === 'watched' ? 'btn-unwatch' : 'btn-watch'}" 
                                onclick="toggleStatus('${item.id}')" 
                                title="${item.status === 'watched' ? 'Mark as To Watch' : 'Mark as Watched'}">
                            <i class="fas ${item.status === 'watched' ? 'fa-undo' : 'fa-eye'}"></i>
                        </button>
                        <button class="action-btn btn-delete" onclick="deleteItem('${item.id}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
            renderWatchlist();
        }

        function showSuggestions(value) {
            const suggestionsEl = document.getElementById('suggestions');
            if (!value.trim()) {
                hidesuggestions();
                return;
            }

            const matches = sampleMovies.filter(movie => 
                movie.toLowerCase().includes(value.toLowerCase()) &&
                !watchlist.find(item => item.title.toLowerCase() === movie.toLowerCase())
            ).slice(0, 5);

            if (matches.length === 0) {
                hidesuggestions();
                return;
            }

            suggestionsEl.innerHTML = matches.map(movie => `
                <div class="suggestion-item" onclick="selectSuggestion('${movie.replace(/'/g, "\\'")}')">
                    ${movie}
                </div>
            `).join('');
            
            suggestionsEl.style.display = 'block';
        }

        function selectSuggestion(title) {
            document.getElementById('titleInput').value = title;
            hidesuggestions();
        }

        function hidesuggestions() {
            document.getElementById('suggestions').style.display = 'none';
        }

        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle i');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeToggle.className = 'fas fa-moon';
                localStorage.setItem('cinetray-theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.className = 'fas fa-sun';
                localStorage.setItem('cinetray-theme', 'dark');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved theme
            const savedTheme = localStorage.getItem('cinetray-theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.querySelector('.theme-toggle i').className = 'fas fa-sun';
            }

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => setFilter(btn.dataset.filter));
            });

            // Search input
            const titleInput = document.getElementById('titleInput');
            titleInput.addEventListener('input', (e) => showSuggestions(e.target.value));
            titleInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addItem();
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.position-relative')) {
                    hidesuggestions();
                }
            });

            // Initialize app
            updateStats();
            renderWatchlist();
            
            // Initialize PWA/TWA features
            detectTWA();
        });

        // Enhanced PWA Service Worker with better error handling
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('sw.js');
                    console.log('CineTray PWA: Service Worker registered successfully', registration.scope);
                    
                    // Show install prompt after successful SW registration
                    setTimeout(() => showPWAInstallPrompt(), 2000);
                } catch (error) {
                    console.log('CineTray PWA: Service Worker registration failed', error);
                    // Even if SW fails, show install prompt for PWA
                    setTimeout(() => showPWAInstallPrompt(), 1000);
                }
            });
        } else {
            console.log('CineTray PWA: Service Workers not supported');
            // Show basic PWA install prompt even without SW support
            setTimeout(() => showPWAInstallPrompt(), 1000);
        }

        // PWA Install Prompt - Enhanced
        let deferredPrompt;
        let installButton;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('CineTray PWA: Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        // Detect if app is already installed
        window.addEventListener('appinstalled', (e) => {
            console.log('CineTray PWA: App was installed');
            hideInstallButton();
            showNotification('ðŸŽ‰ CineTray installed successfully! Launch from your home screen.');
        });

        function showInstallButton() {
            // Add install button to header if not already installed and not already shown
            if (!window.matchMedia('(display-mode: standalone)').matches && !installButton) {
                installButton = document.createElement('button');
                installButton.innerHTML = '';
                installButton.className = 'theme-toggle';
                installButton.title = 'Install CineTray App';
                installButton.style.marginLeft = '0.5rem';
                installButton.onclick = installPWA;
                
                document.querySelector('.header-content').appendChild(installButton);
            }
        }

        function hideInstallButton() {
            if (installButton) {
                installButton.remove();
                installButton = null;
            }
        }

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('CineTray PWA: User accepted the install prompt');
                        hideInstallButton();
                    } else {
                        console.log('CineTray PWA: User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            } else {
                // Fallback for browsers that don't support install prompt
                showNotification('');
            }
        }

        function showPWAInstallPrompt() {
            // Show notification about PWA capabilities
            if (!window.matchMedia('(display-mode: standalone)').matches && 
                !localStorage.getItem('pwa-prompt-shown-v2')) {
                
                // Check if we're on Android Chrome (primary TWA target)
                const isAndroidChrome = /Android/.test(navigator.userAgent) && /Chrome/.test(navigator.userAgent);
                
                if (isAndroidChrome) {
                    showNotification('');
                } else {
                    showNotification('');
                }
                
                localStorage.setItem('pwa-prompt-shown-v2', 'true');
            }
        }

        // TWA (Trusted Web Activity) Detection and Optimization
        function detectTWA() {
            // Check if running in TWA environment
            const isTWA = document.referrer.includes('android-app://') || 
                         window.matchMedia('(display-mode: standalone)').matches ||
                         navigator.standalone === true;
            
            if (isTWA) {
                console.log('CineTray: Running in TWA/PWA mode');
                document.body.classList.add('twa-mode');
                
                // Optimize for TWA
                optimizeForTWA();
            }
        }

        function optimizeForTWA() {
            // Add TWA-specific optimizations
            const style = document.createElement('style');
            style.textContent = `
                .twa-mode {
                    --header-height: calc(2rem + env(safe-area-inset-top));
                }
                
                .twa-mode .header {
                    padding-top: calc(1.5rem + env(safe-area-inset-top));
                }
                
                .twa-mode .container {
                    padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
                }
                
                /* Hide install button in TWA mode */
                .twa-mode .theme-toggle[title*="Install"] {
                    display: none;
                }
            `;
            document.head.appendChild(style);
        }
    </script>
    <script>
        // Global variable for install prompt
        let deferredPrompt = null;
        
        // Function to handle install button click
        function handleInstallClick() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(choiceResult => {
                    console.log(choiceResult.outcome === 'accepted' ? 
                        'User accepted install prompt' : 
                        'User dismissed install prompt');
                    deferredPrompt = null;
                });
            }
        }

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swUrl = new URL('sw.js', window.location.origin + '/CineTray/');
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('CineTray PWA: Service Worker registered successfully', window.location.href);
                    })
                    .catch(error => {
                        console.error('CineTray PWA: Service Worker registration failed: ', error);
                    });
            });
        } else {
            console.warn('Service workers are not supported in this browser');
        }

        // Handle PWA install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('CineTray PWA: Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            const installButton = document.getElementById('install-button');
            if (installButton) {
                // Clone and replace button to prevent duplicate event listeners
                const newButton = installButton.cloneNode(true);
                installButton.parentNode.replaceChild(newButton, installButton);
                newButton.style.display = 'block';
                newButton.onclick = handleInstallClick;
            }
        });

        // Handle successful installation
        window.addEventListener('appinstalled', () => {
            console.log('CineTray was installed as PWA');
            const installButton = document.getElementById('install-button');
            if (installButton) installButton.style.display = 'none';
            deferredPrompt = null;
        });
    </script>
    <script src="app.js"></script>
</body>
</html>
