<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CineTray - Your Personal Watchlist</title>

  <!-- PWA meta -->
  <meta name="theme-color" content="#6366f1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="CineTray" />
  <meta name="application-name" content="CineTray" />
  <meta name="google-play-app" content="app-id=com.cinetray.watchlist" />

  <!-- Use an external manifest.json (clean) -->
  <link rel="manifest" href="manifest.json">

  <!-- Icons (place icon-192.png and icon-512.png in repo root) -->
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    /* simplified/cleaned CSS; you can paste your original CSS here but
       make sure the broken @font-face block is removed */
    * { box-sizing: border-box; }
    :root { --primary:#6366f1; --bg:#ffffff; --text:#0f172a; --muted:#64748b; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin:0; background:var(--bg); color:var(--text); }
    .header { background: linear-gradient(135deg,var(--primary), #4f46e5); color:#fff; padding:1.5rem; }
    .container { max-width:1000px; margin:0 auto; padding:1rem; }
    .logo { display:flex; align-items:center; gap:.5rem; font-weight:700; font-size:1.2rem; }
    .stats { display:flex; gap:1rem; margin:1rem 0; }
    .stat { background:#f8fafc; padding:.8rem 1rem; border-radius:.6rem; border:1px solid #e6eefb; }
    .controls { background:#f8fafc; padding:1rem; border-radius:.6rem; border:1px solid #e6eefb; margin-bottom:1rem; }
    .watchlist { display:grid; gap:1rem; }
    .watchlist-item { background:#fff; border:1px solid #eef2ff; padding:1rem; border-radius:.5rem; }
    .notification { position:fixed; right:1rem; top:1rem; background:var(--primary); color:#fff; padding:.6rem .9rem; border-radius:.5rem; transform: translateX(120%); transition: transform .3s; }
    .notification.show { transform: translateX(0); }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo">ðŸŽ¬ CineTray</div>
    </div>
  </header>

  <main class="container">
    <section class="stats">
      <div class="stat"><div id="totalCount">0</div><small>Total Items</small></div>
      <div class="stat"><div id="watchedCount">0</div><small>Watched</small></div>
      <div class="stat"><div id="toWatchCount">0</div><small>To Watch</small></div>
    </section>

    <section class="controls">
      <input id="titleInput" placeholder="Enter movie or series title..." style="width:70%;padding:.5rem;border-radius:.4rem;border:1px solid #dbeafe;">
      <button id="addBtn" style="padding:.5rem 1rem;margin-left:.5rem;border-radius:.4rem;">Add</button>
    </section>

    <section id="watchlist" class="watchlist">
      <div class="watchlist-item">Your watchlist is empty</div>
    </section>
  </main>

  <div id="notification" class="notification" role="status" aria-live="polite"></div>

  <script>
    // --- minimal app logic (keeps your existing behavior) ---
    let watchlist = JSON.parse(localStorage.getItem('cinetray-watchlist') || '[]');
    const totalEl = document.getElementById('totalCount');
    const watchedEl = document.getElementById('watchedCount');
    const toWatchEl = document.getElementById('toWatchCount');
    const listEl = document.getElementById('watchlist');
    const notifyEl = document.getElementById('notification');

    function render() {
      totalEl.textContent = watchlist.length;
      watchedEl.textContent = watchlist.filter(i=>i.status==='watched').length;
      toWatchEl.textContent = watchlist.filter(i=>i.status!=='watched').length;
      if (watchlist.length === 0) {
        listEl.innerHTML = '<div class="watchlist-item">Your watchlist is empty</div>';
        return;
      }
      listEl.innerHTML = watchlist.map(i=>`<div class="watchlist-item">${i.title}</div>`).join('');
    }
    function show(msg) { notifyEl.textContent = msg; notifyEl.classList.add('show'); setTimeout(()=>notifyEl.classList.remove('show'),2500); }

    document.getElementById('addBtn').addEventListener('click', ()=> {
      const val = document.getElementById('titleInput').value.trim();
      if (!val) { show('Enter a title'); return; }
      watchlist.unshift({ id: Date.now().toString(36), title: val, status: 'to-watch', dateAdded: new Date().toISOString() });
      localStorage.setItem('cinetray-watchlist', JSON.stringify(watchlist));
      document.getElementById('titleInput').value='';
      render();
      show(`"${val}" added`);
    });

    render();

    // --- Correct SW registration (no blob/data urls) ---
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => {
            console.log('CineTray PWA: Service Worker registered', registration.scope);
          })
          .catch(err => {
            console.error('CineTray PWA: Service Worker registration failed', err);
          });
      });
    } else {
      console.log('Service workers not supported');
    }
  </script>
</body>
</html>
